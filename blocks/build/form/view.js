!function(){"use strict";var e={n:function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,{a:r}),r},d:function(t,r){for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.apiFetch,r=e.n(t),s=window.wp.i18n,i=window.wp.domReady,o=e.n(i);const a={name:"required",defaultMessage:((0,s.__)("Required","hizzle-forms"),(0,s.__)("Is this field required?","hizzle-forms"),(0,s.__)("This field is required.","hizzle-forms")),validate:function(e){return e.length>0}},n={name:"maxdate",defaultMessage:((0,s.__)("Maximum date","hizzle-forms"),(0,s.__)("Set a maximum date?","hizzle-forms"),(0,s.__)("The latest date allowed is {threshold}.","hizzle-forms")),validate:function(e,t){return!(/^[0-9]{4,}-[0-9]{2}-[0-9]{2}$/.test(e)&&/^[0-9]{4,}-[0-9]{2}-[0-9]{2}$/.test(t.threshold)&&e>t.threshold)}},l={name:"mindate",defaultMessage:((0,s.__)("Minimum date","hizzle-forms"),(0,s.__)("Set a minimum date?","hizzle-forms"),(0,s.__)("The earliest date allowed is {threshold}.","hizzle-forms")),validate:function(e,t){return!(/^[0-9]{4,}-[0-9]{2}-[0-9]{2}$/.test(e)&&/^[0-9]{4,}-[0-9]{2}-[0-9]{2}$/.test(t.threshold)&&e<t.threshold)}},h={name:"maxnumber",defaultMessage:((0,s.__)("Maximum number","hizzle-forms"),(0,s.__)("Set a maximum number?","hizzle-forms"),(0,s.__)("The value must be at most {threshold}.","hizzle-forms")),validate:function(e,t){return!(parseFloat(e)>parseFloat(t.threshold))}},m={name:"minnumber",defaultMessage:((0,s.__)("Minimum number","hizzle-forms"),(0,s.__)("Set a minimum number?","hizzle-forms"),(0,s.__)("The value must be at least {threshold}.","hizzle-forms")),validate:function(e,t){return!(parseFloat(e)<parseFloat(t.threshold))}},u={name:"maxitems",defaultMessage:((0,s.__)("Maximum items","hizzle-forms"),(0,s.__)("Set a maximum number of selectable items?","hizzle-forms"),(0,s.__)("You must select at most {threshold} items.","hizzle-forms")),validate:function(e,t){return!(e.length>parseInt(t.threshold))}},d={name:"minitems",defaultMessage:((0,s.__)("Minimum items","hizzle-forms"),(0,s.__)("Set a minimum number of selectable items?","hizzle-forms"),(0,s.__)("You must select at least {threshold} items.","hizzle-forms")),validate:function(e,t){return!(e.length<parseInt(t.threshold))}},c={name:"maxlength",defaultMessage:((0,s.__)("Maximum length","hizzle-forms"),(0,s.__)("Set a maximum length?","hizzle-forms"),(0,s.__)("The value must be at most {threshold} characters long.","hizzle-forms")),validate:function(e,t){return!(e.length>parseInt(t.threshold))}},f={name:"minlength",defaultMessage:((0,s.__)("Minimum length","hizzle-forms"),(0,s.__)("Set a minimum length?","hizzle-forms"),(0,s.__)("The value must be at least {threshold} characters long.","hizzle-forms")),validate:function(e,t){return!(e.length<parseInt(t.threshold))}};var z={[a.name]:a,[n.name]:n,[l.name]:l,[h.name]:h,[m.name]:m,[u.name]:u,[d.name]:d,[c.name]:c,[f.name]:f};class _{submissionAttempted=!1;errors=[];rules=[];field=null;constructor(e,t){this.field=e,this.rules=t,this.initEventListeners()}initEventListeners(){this.field.querySelectorAll("input, select, textarea").forEach((e=>{e.addEventListener("blur",(()=>{this.validate()})),e.addEventListener("input",(()=>{this.submissionAttempted&&this.validate()}))}))}validate(){this.errors=[];const e=this.getValue();this.rules.forEach((t=>{if(!z[t.name])return;if(z[t.name].validate(e,t))return;let r=t.errorMessage||z[t.name].defaultMessage;Object.keys(t).forEach((e=>{r=r.replace(`{${e}}`,t[e])})),this.errors.push(r)})),this.toggleError()}getValue(){if(this.field.classList.contains("wp-block-hizzle-forms-radio")){const e=[];let t=!1;return this.field.querySelectorAll("input").forEach((r=>{t="checkbox"===r.type,r.checked&&e.push(r.value)})),t?e:e[0]||""}if(this.field.classList.contains("wp-block-hizzle-forms-checkbox")){const e=this.field.querySelector('input[type="checkbox"]');return!!e&&e.checked}const e=this.field.querySelector("select, input, textarea");return e?e.value:""}toggleError(){const e=this.field.querySelector(".hizzle-forms__field-error");if(this.errors.length)return e.innerHTML=this.errors[0],void this.field.classList.add("hizzle-forms__field--has-error");e.innerHTML="",this.field.classList.remove("hizzle-forms__field--has-error")}}const g=(e,t,r)=>{if(""===e)return t;const s=e.split("[");if(1===s.length)return{...r,[e]:t};if(2===s.length){const[e,i]=s,o=i.slice(0,-1);if(""===o){const s=r[e]||[];return s.push(t),{...r,[e]:s}}const a=r[e]||{};return{...r,[e]:{...a,[o]:t}}}const[i,...o]=s;let a=o.join("[");if(!a.startsWith("]")){const e=r[i]||{};return{...r,[i]:g(a.replace(/\]/,""),t,e)}}const n=r[i]||[];return n.push(g(a.slice(1).replace(/\[/,"").replace(/\]/,""),t,{})),{...r,[i]:n}},p=e=>{let t={};return e.forEach(((e,r)=>{t=g(r,e,t)})),t};o()((()=>{document.querySelectorAll(".wp-block-hizzle-forms-form").forEach((e=>{const t=function(e){const t={};return e.querySelectorAll(".hizzle-forms-field").forEach((e=>{const r=e.dataset.instanceId;try{let s=e.dataset.validation?JSON.parse(e.dataset.validation):[];Array.isArray(s)||(s=[]),r&&(t[r]=new _(e,s))}catch(s){t[r]=new _(e,[]),console.error(s)}})),{errors:[],fields:t,validate(){let e=!1;return this.errors=[],Object.keys(t).forEach((r=>{t[r].submissionAttempted=!0,t[r].validate(),t[r].errors.length&&(e=!0)})),!e},displayError(e,r){if(t[e])return t[e].errors=[r],void t[e].toggleError();this.errors=[r],this.toggleError()},toggleError(){const t=e.querySelector(".hizzle-forms__form-error");if(this.errors.length)return t.innerHTML=this.errors[0],void t.classList.add("hizzle-forms__form--has-error");t.innerHTML="",t.classList.remove("hizzle-forms__form--has-error")}}}(e);e.querySelectorAll("input, select, textarea").forEach((e=>{e.addEventListener("change",(()=>{t.errors.length>0&&(t.errors=[],t.toggleError())}))}));const i=()=>{const t=e.querySelector(".hizzle-forms__field--has-error");t&&t.scrollIntoView({behavior:"smooth"})};e.addEventListener("submit",(o=>{if(o.preventDefault(),!t.validate())return void i();const a=e.dataset.instanceId,n=new FormData(e);n.append("hizzle_conversion_page",window.location.href),e.classList.add("hizzle-forms-submitting"),r()({path:"/hizzle/v1/forms/submit/"+a,method:"POST",data:p(n)}).then((t=>("message"===t.action&&(e.outerHTML=`<div class="wp-block-hizzle-forms__success-message">${t.message}</div>`,e.classList.remove("hizzle-forms-submitting")),"redirect"===t.action&&(window.location.href=t.redirect),t))).catch((r=>{r.code?(t.displayError(r.code,r.message),r.additional_errors&&r.additional_errors.forEach((e=>{t.displayError(e.code,e.message)}))):t.displayError("unknown",(0,s.__)("An unknown error occurred while submitting the form. Check your network connectivity then try again.","hizzle-forms")),e.classList.remove("hizzle-forms-submitting"),i()}))}))}))}))}();